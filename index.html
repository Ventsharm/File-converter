<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>File Converter</title>
  <meta name="theme-color" content="#0f172a" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="icon" href="Icon-192.png" />
  <style>
    :root { --bg:#0f172a; --card:#111827; --muted:#94a3b8; --text:#e5e7eb; --accent:#22c55e; }
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,#0b1220,#0f172a);color:var(--text);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell}
    .wrap{max-width:1100px;margin:0 auto;padding:24px}
    .title{font-size:clamp(22px,3vw,34px);font-weight:800;letter-spacing:.3px}
    .muted{color:var(--muted)}
    .grid{display:grid;gap:16px}
    @media (min-width:900px){.grid{grid-template-columns:360px 1fr}}
    .card{background:linear-gradient(180deg,#0b1220,#0f172a);border:1px solid rgba(255,255,255,.06);border-radius:16px;box-shadow:0 20px 40px rgba(0,0,0,.35)}
    .card>div{padding:18px}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    label{font-weight:600}
    input[type="number"],select,input[type="file"]{background:#0b1220;border:1px solid rgba(255,255,255,.12);color:var(--text);padding:10px 12px;border-radius:12px}
    input[type="checkbox"]{width:18px;height:18px}
    button{background:var(--accent);color:#052e16;border:0;padding:12px 16px;border-radius:14px;font-weight:800;cursor:pointer}
    button.secondary{background:#1f2937;color:#e5e7eb}
    .out{padding:16px;min-height:140px;border-radius:12px;background:#0b1220;border:1px dashed rgba(255,255,255,.12)}
    .thumb{display:inline-flex;flex-direction:column;align-items:center;gap:8px;margin:8px;padding:8px;border:1px solid rgba(255,255,255,.08);border-radius:12px}
    .thumb img{max-width:160px;max-height:110px;border-radius:8px}
    .small{font-size:12px}
    .badge{display:inline-block;padding:2px 8px;border-radius:999px;background:rgba(255,255,255,.08);font-size:12px}
    .footer{opacity:.7}
    .hidden{display:none}
    .progress{height:6px;background:#0b1220;border:1px solid rgba(255,255,255,.08);border-radius:999px;overflow:hidden}
    .bar{height:100%;background:var(--accent);width:0}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="row" style="justify-content:space-between;gap:12px">
      <div>
        <div class="title">File Converter</div>
        <div class="muted">Offline‑ready • No Firebase • No Stripe • PWA compatible</div>
      </div>
      <div><span class="badge">v1.0</span></div>
    </div>

    <div class="grid" style="margin-top:18px">
      <!-- Controls -->
      <div class="card">
        <div>
          <div class="row"><label for="files">Select files</label></div>
          <input id="files" type="file" multiple accept="image/png,image/jpeg,image/webp,application/pdf" />

          <hr style="border-color:rgba(255,255,255,.06);margin:16px 0"/>

          <div class="row">
            <label>Output</label>
            <select id="format">
              <option value="png">PNG</option>
              <option value="jpeg">JPG</option>
              <option value="webp">WEBP</option>
              <option value="pdf">PDF</option>
            </select>
          </div>

          <div class="row">
            <label>Quality</label>
            <input id="quality" type="number" step="0.05" min="0.1" max="1" value="0.92" />
            <span class="muted small">(image formats only)</span>
          </div>

          <div class="row">
            <label>Resize</label>
            <input id="width" type="number" placeholder="Width" min="1" />
            <span>×</span>
            <input id="height" type="number" placeholder="Height" min="1" />
            <select id="units">
              <option value="px">px</option>
              <option value="in">in</option>
              <option value="cm">cm</option>
            </select>
            <label class="row" style="gap:6px"><input id="lock" type="checkbox" checked/> Keep ratio</label>
          </div>

          <div class="row">
            <label>DPI</label>
            <input id="dpi" type="number" value="300" min="72" max="1200" />
            <span class="muted small">(in/cm → px & PDF sizing)</span>
          </div>

          <div class="row">
            <button id="convert">Convert</button>
            <button id="clear" class="secondary">Clear</button>
          </div>

          <div style="margin-top:12px" class="progress hidden" id="progress"><div class="bar" id="bar"></div></div>
        </div>
      </div>

      <!-- Output -->
      <div class="card">
        <div>
          <div class="row" style="justify-content:space-between"><strong>Output</strong><span class="muted small">Click to download</span></div>
          <div id="output" class="out"></div>
        </div>
      </div>
    </div>

    <p class="footer small" style="margin-top:18px">Tip: Multiple images → choose <b>PDF</b> to combine into a single PDF. Uploading a PDF → choose <b>PNG/JPG/WEBP</b> to export pages as images.</p>
  </div>

  <!-- PDF libs -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@4.10.38/build/pdf.min.js"></script>
  <script>if (window['pdfjsLib']){ pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdn.jsdelivr.net/npm/pdfjs-dist@4.10.38/build/pdf.worker.min.js'; }</script>

  <script>
  (function(){
    const $ = s=>document.querySelector(s);
    const filesEl=$('#files'), formatEl=$('#format'), qEl=$('#quality'), wEl=$('#width'), hEl=$('#height'), lockEl=$('#lock'), unitsEl=$('#units'), dpiEl=$('#dpi');
    const outEl=$('#output'), convertBtn=$('#convert'), clearBtn=$('#clear'), progress=$('#progress'), bar=$('#bar');

    const inToPx=(inch,dpi)=>Math.round(inch*dpi); const cmToPx=(cm,dpi)=>Math.round((cm/2.54)*dpi);
    const toPx=(v,u,d)=>!v?undefined:u==='px'?Math.round(v):u==='in'?inToPx(v,d):cmToPx(v,d);

    function setProgress(fr){ progress.classList.remove('hidden'); bar.style.width=Math.max(1,Math.min(100,Math.round(fr*100)))+'%'; if(fr>=1) setTimeout(()=>progress.classList.add('hidden'),600); }
    function addThumb(url,name){ const d=document.createElement('div'); d.className='thumb'; const i=new Image(); i.loading='lazy'; i.src=url; const c=document.createElement('div'); c.className='small muted'; c.textContent=name; d.append(i,c); d.addEventListener('click',()=>{ const a=document.createElement('a'); a.href=url; a.download=name; a.click();}); outEl.appendChild(d);}    
    function extFor(fmt){return fmt==='jpeg'?'jpg':fmt;}

    async function fileToImage(file){ const u=URL.createObjectURL(file); const img=new Image(); img.decoding='async'; img.src=u; await img.decode(); URL.revokeObjectURL(u); return img; }
    async function imageToCanvas(img, tw, th, lock){ if(tw&&!th&&lock) th=Math.round(img.height*(tw/img.width)); if(th&&!tw&&lock) tw=Math.round(img.width*(th/img.height)); const cnv=document.createElement('canvas'); cnv.width=tw||img.width; cnv.height=th||img.height; cnv.getContext('2d').drawImage(img,0,0,cnv.width,cnv.height); return cnv; }

    async function convertImages(files, fmt, opts){ const res=[]; for(let i=0;i<files.length;i++){ setProgress(i/(files.length+0.0001)); const img=await fileToImage(files[i]); const tw=toPx(opts.w,opts.units,opts.dpi); const th=toPx(opts.h,opts.units,opts.dpi); const cnv=await imageToCanvas(img,tw,th,opts.lock); const blob=await new Promise(r=>cnv.toBlob(r,'image/'+fmt,fmt==='png'?undefined:opts.quality)); const url=URL.createObjectURL(blob); const name=files[i].name.replace(/\.[^.]+$/, '')+'.'+extFor(fmt); res.push({url,name,blob}); } setProgress(1); return res; }

    async function imagesToPDF(files, opts){ const { jsPDF }=window.jspdf; const dpi=opts.dpi; const doc=new jsPDF({unit:'pt',compress:true}); let first=true; for(let i=0;i<files.length;i++){ setProgress(i/(files.length+0.0001)); const img=await fileToImage(files[i]); const pxW=toPx(opts.w,opts.units,dpi)||img.width; const pxH=opts.lock?Math.round(img.height*(pxW/img.width)):(toPx(opts.h,opts.units,dpi)||img.height); const ptW=(pxW/dpi)*72, ptH=(pxH/dpi)*72; const cnv=await imageToCanvas(img,pxW,pxH,true); const dataURL=cnv.toDataURL('image/jpeg',0.92); if(first){doc.deletePage(1); first=false;} doc.addPage([ptW,ptH]); doc.addImage(dataURL,'JPEG',0,0,ptW,ptH); }
      const blob=doc.output('blob'); setProgress(1); return blob; }

    async function pdfToImages(file, fmt, opts){ const out=[]; const ab=await file.arrayBuffer(); const pdf=await pdfjsLib.getDocument({data:ab}).promise; for(let p=1;p<=pdf.numPages;p++){ setProgress((p-1)/(pdf.numPages+0.0001)); const page=await pdf.getPage(p); const viewport=page.getViewport({scale:(opts.dpi||300)/72}); const cnv=document.createElement('canvas'); const ctx=cnv.getContext('2d'); const w=toPx(opts.w,opts.units,opts.dpi)||viewport.width; const h=opts.lock?Math.round(w*(viewport.height/viewport.width)):(toPx(opts.h,opts.units,opts.dpi)||viewport.height); cnv.width=w; cnv.height=h; await page.render({canvasContext:ctx, viewport:new pdfjsLib.PageViewport({viewBox:[0,0,viewport.width,viewport.height], scaleX:w/viewport.width, scaleY:h/viewport.height, rotation:0, offsetX:0, offsetY:0, dontFlip:false})}).promise; const blob=await new Promise(r=>cnv.toBlob(r,'image/'+fmt,fmt==='png'?undefined:opts.quality)); const url=URL.createObjectURL(blob); const name=file.name.replace(/\.[^.]+$/,'')+`-p${p}.`+extFor(fmt); out.push({url,name,blob}); } setProgress(1); return out; }

    function isPDF(f){return /pdf$/i.test(f.type)||/\.pdf$/i.test(f.name);} function isImage(f){return /^image\//.test(f.type);}    

    clearBtn.addEventListener('click',()=>{ outEl.innerHTML=''; filesEl.value=''; });

    convertBtn.addEventListener('click', async ()=>{
      const files=Array.from(filesEl.files||[]);
      if(!files.length){ alert('Select at least one file'); return; }
      outEl.innerHTML='';
      const fmt=formatEl.value; const opts={ quality:Math.max(0.1,Math.min(1,parseFloat(qEl.value)||0.92)), w:parseFloat(wEl.value)||undefined, h:parseFloat(hEl.value)||undefined, units:unitsEl.value, dpi:Math.max(72,Math.min(1200,parseInt(dpiEl.value)||300)), lock:lockEl.checked };
      try{
        setProgress(0.01);
        if(fmt==='pdf'){
          const imgs=files.filter(isImage);
          if(!imgs.length){ alert('For PDF output, upload images.'); setProgress(1); return; }
          const pdfBlob=await imagesToPDF(imgs,opts);
          const url=URL.createObjectURL(pdfBlob); const name=(imgs[0]?.name?.replace(/\.[^.]+$/, '')||'images')+'.pdf';
          addThumb(url,name);
        } else {
          // If input is PDF → images per page; if images → convert directly
          const outputs=[];
          const pdfs=files.filter(isPDF); const imgs=files.filter(isImage);
          for(const f of imgs){ const arr=await convertImages([f],fmt,opts); outputs.push(...arr); }
          for(const f of pdfs){ const arr=await pdfToImages(f,fmt,opts); outputs.push(...arr); }
          outputs.forEach(o=>addThumb(o.url,o.name));
        }
      } catch(err){ console.error(err); alert('Conversion failed: '+(err?.message||err)); setProgress(1); }
    });

    if('serviceWorker' in navigator){ navigator.serviceWorker.register('service-worker.js'); }
  })();
  </script>
</body>
</html>
